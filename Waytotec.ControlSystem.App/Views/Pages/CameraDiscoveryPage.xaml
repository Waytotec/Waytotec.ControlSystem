<!--  Waytotec.ControlSystem.App/Views/Pages/CameraDiscoveryPage.xaml  -->
<Page
    x:Class="Waytotec.ControlSystem.App.Views.Pages.CameraDiscoveryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Waytotec.ControlSystem.App.Views.Controls"
    xmlns:conv="clr-namespace:Waytotec.ControlSystem.App.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Waytotec.ControlSystem.App.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="카메라 검색3"
    d:DataContext="{d:DesignInstance local:CameraDiscoveryPage,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="700"
    d:DesignWidth="1200"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">

    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!--  ModernGroupBox 스타일을 포함하는 ResourceDictionary를 머지  -->
                <ResourceDictionary Source="/Resources/ModernGroupBoxStyle.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!--  상태별 색상 컨버터들  -->
            <conv:StatusToColorConverter x:Key="StatusToColorConverter" />
            <conv:StatusToTextColorConverter x:Key="StatusToTextColorConverter" />
            <conv:StatusToRowBackgroundConverter x:Key="StatusToRowBackgroundConverter" />
            <conv:StatusToIconConverter x:Key="StatusToIconConverter" />
            <conv:StatusToBorderConverter x:Key="StatusToBorderConverter" />

            <!--  불린 반전 컨버터  -->
            <conv:InverseBooleanConverter x:Key="InverseBooleanConverter" />

            <!--  GroupBox 콘텐츠 높이 계산 컨버터  -->
            <conv:GroupBoxContentHeightConverter x:Key="GroupBoxContentHeightConverter" />

            <conv:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />


            <!--  DataGrid 행 스타일 - 상태별 배경색 적용  -->
            <Style x:Key="StatusRowStyle" TargetType="DataGridRow">
                <Setter Property="Background" Value="{Binding Status, Converter={StaticResource StatusToRowBackgroundConverter}}" />
                <Setter Property="BorderBrush" Value="{Binding Status, Converter={StaticResource StatusToBorderConverter}}" />
                <Setter Property="BorderThickness" Value="0,0,0,1" />
                <Style.Triggers>
                    <!--  선택된 행 스타일  -->
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="{DynamicResource SystemControlHighlightListAccentLowBrush}" />
                        <Setter Property="BorderBrush" Value="{DynamicResource SystemControlHighlightAccentBrush}" />
                        <Setter Property="BorderThickness" Value="2" />
                    </Trigger>
                    <!--  마우스 오버 스타일  -->
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource SystemControlHighlightListLowBrush}" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!--  상태 셀 스타일  -->
            <Style x:Key="StatusCellStyle" TargetType="DataGridCell">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="DataGridCell">
                            <Grid Background="{TemplateBinding Background}">
                                <StackPanel
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Orientation="Horizontal">
                                    <!--  상태 아이콘  -->
                                    <TextBlock
                                        Margin="0,0,8,0"
                                        FontSize="16"
                                        FontWeight="Bold"
                                        Foreground="{Binding Status, Converter={StaticResource StatusToColorConverter}}"
                                        Text="{Binding Status, Converter={StaticResource StatusToIconConverter}}" />
                                    <!--  상태 텍스트  -->
                                    <TextBlock
                                        FontSize="12"
                                        FontWeight="SemiBold"
                                        Foreground="{Binding Status, Converter={StaticResource StatusToTextColorConverter}}"
                                        Text="{Binding StatusText}" />
                                </StackPanel>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </Page.Resources>

    <!--  전체 컨테이너 - 스크롤 없음  -->
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <!--  상단 영역 - Auto로 변경  -->
            <RowDefinition Height="*" />
            <!--  중앙 영역 - * 유지  -->
            <RowDefinition Height="Auto" />
            <!--  하단 영역 - Auto로 변경  -->
        </Grid.RowDefinitions>

        <!--  상단 영역 (고정)  -->
        <StackPanel Grid.Row="0">
            <!--  검색 컨트롤  -->
            <GroupBox Header="검색 옵션" Style="{StaticResource ModernGroupBoxStyle}">
                <StackPanel>
                    <!--  검색 버튼들  -->
                    <WrapPanel Margin="0,0,0,15">
                        <ui:Button
                            Margin="0,0,10,10"
                            Padding="12,8"
                            Command="{Binding ScanCommand}"
                            Content="전체 검색"
                            Icon="{ui:SymbolIcon Search24}"
                            IsEnabled="{Binding IsScanning, Converter={StaticResource InverseBooleanConverter}}" />

                        <ui:Button
                            Margin="0,0,10,10"
                            Padding="12,8"
                            Command="{Binding StartContinuousScanCommand}"
                            Content="실시간 검색"
                            Icon="{ui:SymbolIcon Play24}"
                            IsEnabled="{Binding IsScanning, Converter={StaticResource InverseBooleanConverter}}" />

                        <ui:Button
                            Margin="0,0,10,10"
                            Padding="12,8"
                            Appearance="Danger"
                            Command="{Binding StopScanCommand}"
                            Content="검색 중지"
                            Icon="{ui:SymbolIcon Stop24}"
                            IsEnabled="{Binding IsScanning}" />

                        <ui:Button
                            Margin="0,0,10,10"
                            Padding="12,8"
                            Appearance="Success"
                            Command="{Binding GenerateTestDataCommand}"
                            Content="테스트 데이터"
                            Icon="{ui:SymbolIcon Beaker24}"
                            ToolTip="실제 카메라가 없을 때 100건의 테스트 데이터를 생성합니다" />

                        <ui:Button
                            Margin="0,0,10,10"
                            Padding="12,8"
                            Appearance="Secondary"
                            Command="{Binding ScanRangeCommand}"
                            Content="대역 검색"
                            Icon="{ui:SymbolIcon Globe24}"
                            IsEnabled="{Binding IsScanning, Converter={StaticResource InverseBooleanConverter}}" />

                        <ui:Button
                            Margin="0,0,10,10"
                            Padding="12,8"
                            Appearance="Secondary"
                            Command="{Binding ClearListCommand}"
                            Content="목록 지우기"
                            Icon="{ui:SymbolIcon Delete24}"
                            IsEnabled="{Binding IsScanning, Converter={StaticResource InverseBooleanConverter}}" />
                    </WrapPanel>

                    <!--  필터 및 검색 설정  -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="20" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!--  필터 영역  -->
                        <GroupBox
                            Grid.Column="0"
                            Header="필터"
                            Style="{StaticResource ModernGroupBoxStyle}">
                            <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                <ui:TextBox
                                    Width="250"
                                    Margin="0,0,5,0"
                                    PlaceholderText="IP, MAC, 시리얼번호 검색..."
                                    Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}" />

                                <CheckBox
                                    Margin="0,0,5,0"
                                    Content="온라인만 표시"
                                    IsChecked="{Binding ShowOnlineOnly}" />
                                <CheckBox Content="오프라인만 표시" IsChecked="{Binding ShowOfflineOnly}" />
                            </StackPanel>
                        </GroupBox>

                        <!--  대역 검색 설정  -->
                        <GroupBox
                            Grid.Column="2"
                            Header="대역 설정"
                            Style="{StaticResource ModernGroupBoxStyle}">
                            <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                <TextBlock
                                    Margin="0,0,8,0"
                                    VerticalAlignment="Center"
                                    Text="IP 대역:" />
                                <ui:TextBox
                                    Width="130"
                                    Margin="0,0,5,0"
                                    VerticalAlignment="Center"
                                    Text="{Binding NetworkRange}" />
                                <TextBlock
                                    Margin="0,0,5,0"
                                    VerticalAlignment="Center"
                                    Text="/" />
                                <ui:NumberBox
                                    Width="130"
                                    VerticalAlignment="Center"
                                    Maximum="255"
                                    Minimum="8"
                                    SpinButtonPlacementMode="Inline"
                                    Value="{Binding NetworkMask}" />
                            </StackPanel>
                        </GroupBox>
                    </Grid>
                </StackPanel>
            </GroupBox>
        </StackPanel>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="10" />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="50" />
            </Grid.RowDefinitions>
            <!--  중앙 영역 - 카메라 목록 (스크롤 가능)  -->
            <GroupBox
                Grid.Row="0"
                Grid.Column="0"
                Header="검색된 카메라 목록"
                Style="{StaticResource ModernGroupBoxStyle}">
                <Grid
                    MaxHeight="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType={x:Type GroupBox}}, Converter={StaticResource GroupBoxContentHeightConverter}}"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch">
                    <!--  DataGrid와 진행률 표시를 위한 Grid  -->
                    <ui:DataGrid
                        Name="CameraDataGrid"
                        VerticalAlignment="Stretch"
                        AutoGenerateColumns="False"
                        BorderThickness="0"
                        CanUserAddRows="False"
                        CanUserDeleteRows="False"
                        CanUserReorderColumns="True"
                        CanUserResizeColumns="True"
                        CanUserSortColumns="True"
                        GridLinesVisibility="Horizontal"
                        HeadersVisibility="Column"
                        HorizontalGridLinesBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                        IsReadOnly="True"
                        ItemsSource="{Binding CamerasView}"
                        KeyDown="CameraDataGrid_KeyDown"
                        LoadingRow="CameraDataGrid_LoadingRow"
                        MouseDoubleClick="CameraDataGrid_MouseDoubleClick"
                        RowHeight="30"
                        ScrollViewer.CanContentScroll="True"
                        ScrollViewer.HorizontalScrollBarVisibility="Auto"
                        ScrollViewer.VerticalScrollBarVisibility="Auto"
                        SelectedItem="{Binding SelectedCamera}"
                        SelectionChanged="CameraDataGrid_SelectionChanged"
                        SelectionMode="Extended"
                        SelectionUnit="FullRow"
                        UnloadingRow="CameraDataGrid_UnloadingRow"
                        VirtualizingPanel.IsVirtualizing="True"
                        VirtualizingPanel.ScrollUnit="Pixel"
                        VirtualizingPanel.VirtualizationMode="Recycling">

                        <ui:DataGrid.Resources>
                            <!--  체크박스 컬럼을 위한 스타일  -->
                            <Style x:Key="CenterCheckBox" TargetType="CheckBox">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <Setter Property="IsTabStop" Value="False" />
                            </Style>

                            <!--  개선된 컬럼 헤더 스타일  -->
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="{DynamicResource SubtleFillColorSecondaryBrush}" />
                                <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
                                <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
                                <Setter Property="BorderThickness" Value="0,0,1,1" />
                                <Setter Property="Padding" Value="8,6" />
                                <Setter Property="FontWeight" Value="SemiBold" />
                                <Setter Property="FontSize" Value="12" />
                                <Setter Property="HorizontalContentAlignment" Value="Center" />
                                <Setter Property="VerticalContentAlignment" Value="Center" />
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource SubtleFillColorTertiaryBrush}" />
                                        <Setter Property="Cursor" Value="Hand" />
                                    </Trigger>
                                    <Trigger Property="SortDirection" Value="Ascending">
                                        <Setter Property="Background" Value="{DynamicResource AccentFillColorSecondaryBrush}" />
                                        <Setter Property="Foreground" Value="{DynamicResource TextOnAccentFillColorPrimaryBrush}" />
                                    </Trigger>
                                    <Trigger Property="SortDirection" Value="Descending">
                                        <Setter Property="Background" Value="{DynamicResource AccentFillColorSecondaryBrush}" />
                                        <Setter Property="Foreground" Value="{DynamicResource TextOnAccentFillColorPrimaryBrush}" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>

                            <!--  셀 스타일 개선  -->
                            <Style TargetType="DataGridCell">
                                <!--<Setter Property="Padding" Value="4,4" />-->
                                <!--<Setter Property="VerticalAlignment" Value="Center" />-->
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="Transparent" />
                                        <Setter Property="Foreground" Value="{DynamicResource TextOnAccentFillColorPrimaryBrush}" />
                                    </Trigger>
                                    <!--<Trigger Property="IsFocused" Value="True">
        <Setter Property="BorderThickness" Value="0" />
    </Trigger>-->
                                </Style.Triggers>
                            </Style>
                        </ui:DataGrid.Resources>

                        <!--  기존 DataGrid.Columns를 다음과 같이 수정 - 정렬 최적화 적용  -->
                        <ui:DataGrid.Columns>
                            <!--  체크박스 컬럼 (다중 선택용) - 새로 추가  -->
                            <DataGridTemplateColumn
                                Width="40"
                                CanUserSort="False"
                                Header="☐"
                                Visibility="Hidden">
                                <DataGridTemplateColumn.HeaderTemplate>
                                    <DataTemplate>
                                        <CheckBox
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Command="{Binding DataContext.SelectAllCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            IsChecked="{Binding DataContext.IsAllSelected, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            Style="{StaticResource CenterCheckBox}"
                                            ToolTip="모두 선택/해제" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.HeaderTemplate>
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox
                                            Click="CheckBox_Click"
                                            IsChecked="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridRow}}"
                                            Style="{StaticResource CenterCheckBox}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!--  ID 컬럼 (순번) - 정렬 비활성화  -->
                            <DataGridTextColumn
                                Width="50"
                                Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=Header}"
                                CanUserSort="False"
                                Header="ID"
                                IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center" />
                                        <Setter Property="VerticalAlignment" Value="Center" />
                                        <Setter Property="FontFamily" Value="맑은 고딕" />
                                        <Setter Property="FontSize" Value="13" />
                                        <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!--  IP 주소 - IP 정렬 최적화  -->
                            <DataGridTextColumn
                                Width="110"
                                Binding="{Binding IpAddressString}"
                                CanUserSort="True"
                                Header="IP"
                                SortMemberPath="IpAddressAsUInt">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center" />
                                        <Setter Property="VerticalAlignment" Value="Center" />
                                        <Setter Property="FontFamily" Value="맑은 고딕" />
                                        <Setter Property="FontSize" Value="13" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!--  MAC 주소 - MAC 정렬 최적화  -->
                            <DataGridTextColumn
                                Width="140"
                                Binding="{Binding FormattedMacAddress}"
                                CanUserSort="True"
                                Header="MAC"
                                SortMemberPath="MacAddress">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center" />
                                        <Setter Property="VerticalAlignment" Value="Center" />
                                        <Setter Property="FontFamily" Value="맑은 고딕" />
                                        <Setter Property="FontSize" Value="13" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!--  시리얼 번호 - 영숫자 정렬  -->
                            <DataGridTextColumn
                                Width="160"
                                Binding="{Binding SerialNumber}"
                                CanUserSort="True"
                                Header="SN"
                                SortMemberPath="SerialNumber">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center" />
                                        <Setter Property="VerticalAlignment" Value="Center" />
                                        <Setter Property="FontFamily" Value="맑은 고딕" />
                                        <Setter Property="FontSize" Value="13" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!--  버전 - 버전 비교 정렬 최적화  -->
                            <DataGridTextColumn
                                Width="100"
                                Binding="{Binding Version}"
                                CanUserSort="True"
                                Header="Version"
                                SortMemberPath="Version"
                                Visibility="Hidden">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center" />
                                        <Setter Property="VerticalAlignment" Value="Center" />
                                        <Setter Property="FontFamily" Value="맑은 고딕" />
                                        <Setter Property="FontSize" Value="13" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!--  상태 - 열거형 정렬 최적화  -->
                            <DataGridTemplateColumn
                                Width="80"
                                CanUserSort="True"
                                Header="Status"
                                SortMemberPath="Status">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid HorizontalAlignment="Center">
                                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                                <Ellipse
                                                    Width="10"
                                                    Height="10"
                                                    Margin="0,0,5,0"
                                                    VerticalAlignment="Center"
                                                    Fill="{Binding Status, Converter={StaticResource StatusToColorConverter}}"
                                                    ToolTip="{Binding StatusText}" />
                                                <TextBlock
                                                    VerticalAlignment="Center"
                                                    FontFamily="맑은 고딕"
                                                    FontSize="13"
                                                    Text="{Binding StatusText}" />
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!--  포트 정보  -->
                            <DataGridTemplateColumn
                                Width="180"
                                CanUserSort="False"
                                Header="포트 정보">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Padding="5,0,0,0" VerticalAlignment="Center">
                                            <Run FontWeight="Medium" Text="HTTP:" />
                                            <Run Text="{Binding HttpPort}" />
                                            <Run FontWeight="Medium" Text="  RTSP:" />
                                            <Run Text="{Binding RtspPort}" />
                                        </TextBlock>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </ui:DataGrid.Columns>

                        <ui:DataGrid.RowStyle>
                            <Style TargetType="DataGridRow">
                                <Setter Property="Background" Value="Transparent" />
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource SubtleFillColorTertiaryBrush}" />
                                    </Trigger>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource AccentFillColorDefaultBrush}" />
                                    </Trigger>
                                    <DataTrigger Binding="{Binding Status}" Value="Offline">
                                        <Setter Property="Opacity" Value="0.6" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Status}" Value="Error">
                                        <Setter Property="Foreground" Value="{DynamicResource SystemFillColorCriticalBrush}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ui:DataGrid.RowStyle>

                        <ui:DataGrid.ContextMenu>
                            <ContextMenu>
                                <MenuItem
                                    Command="{Binding ExportSelectedCommand}"
                                    Header="파일로 내보내기"
                                    Icon="{ui:SymbolIcon Symbol=SaveArrowRight24}" />
                                <MenuItem
                                    Command="{Binding PingShellCommand}"
                                    Header="핑 테스트"
                                    Icon="{ui:SymbolIcon Symbol=PlugConnectedCheckmark20}" />
                                <MenuItem
                                    Command="{Binding OpenWebConfigShellCommand}"
                                    Header="웹 페이지"
                                    Icon="{ui:SymbolIcon Symbol=DocumentPageBottomCenter24}" />
                                <Separator />
                                <MenuItem Header="정렬">
                                    <MenuItem
                                        Command="{Binding SortCommand}"
                                        CommandParameter="IP주소"
                                        Header="IP주소로 정렬" />
                                    <MenuItem
                                        Command="{Binding SortCommand}"
                                        CommandParameter="MAC주소"
                                        Header="MAC주소로 정렬" />
                                    <MenuItem
                                        Command="{Binding SortCommand}"
                                        CommandParameter="상태"
                                        Header="상태로 정렬" />
                                    <MenuItem
                                        Command="{Binding SortCommand}"
                                        CommandParameter="시리얼번호"
                                        Header="시리얼번호로 정렬" />
                                </MenuItem>
                                <Separator />
                                <MenuItem
                                    Click="CopyToClipboard_Click"
                                    Header="클립보드에 복사"
                                    Icon="{ui:SymbolIcon Copy24}" />
                            </ContextMenu>
                        </ui:DataGrid.ContextMenu>
                    </ui:DataGrid>

                    <!--  진행률 표시 오버레이  -->
                    <Border
                        Panel.ZIndex="10"
                        Style="{StaticResource ProgressOverlayStyle}"
                        Visibility="{Binding ShowProgress, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid>
                            <StackPanel
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Orientation="Vertical">
                                <ui:ProgressRing
                                    Width="60"
                                    Height="60"
                                    IsIndeterminate="False"
                                    Progress="{Binding ScanProgress}" />
                                <TextBlock
                                    Margin="0,20,0,10"
                                    HorizontalAlignment="Center"
                                    FontSize="16"
                                    FontWeight="Medium"
                                    Foreground="White"
                                    Text="{Binding StatusMessage}" />
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    FontSize="24"
                                    FontWeight="Bold"
                                    Foreground="White">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0:F0}%">
                                            <Binding Path="ScanProgress" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </GroupBox>

            <StackPanel
                Grid.Row="1"
                Grid.Column="0"
                Orientation="Horizontal">
                <!--  검색 버튼들  -->
                <WrapPanel Margin="0,5,0,0">
                    <ui:Button
                        Margin="0,0,10,10"
                        Padding="12,8"
                        Command="{Binding ToggleSelectAllCommand}"
                        Content="{Binding SelectAllButtonText}"
                        Icon="{ui:SymbolIcon Symbol=SelectAllOn24}"
                        ToolTip="DataGrid의 모든 항목을 선택하거나 선택 해제합니다" />
                    <ui:InfoBadge
                        Margin="-20,-40,0,0"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        Severity="Caution"
                        Visibility="{Binding SelectedCount, Converter={StaticResource CountToVisibilityConverter}}"
                        Value="{Binding SelectedCount}" />
                    <ui:Button
                        Margin="0,0,10,10"
                        Padding="12,8"
                        Command="{Binding ExportSelectedCommand}"
                        Content="내보내기"
                        Icon="{ui:SymbolIcon Symbol=SaveArrowRight24}" />
                    <ui:Button
                        Margin="0,0,10,10"
                        Padding="12,8"
                        Command="{Binding PingShellCommand}"
                        Content="핑 테스트"
                        Icon="{ui:SymbolIcon Symbol=PlugConnectedCheckmark20}" />
                    <ui:Button
                        Margin="0,0,10,10"
                        Padding="12,8"
                        Command="{Binding OpenWebConfigShellCommand}"
                        Content="웹 페이지"
                        Icon="{ui:SymbolIcon Symbol=DocumentPageBottomCenter24}" />
                    <ui:Button
                        Margin="0,0,10,10"
                        Padding="12,8"
                        Command="{Binding ScanCommand}"
                        Content="재부팅"
                        Icon="{ui:SymbolIcon Symbol=ArrowReset24}" />
                </WrapPanel>
            </StackPanel>

            <!--  영상 영역  -->
            <GroupBox
                Grid.Row="0"
                Grid.RowSpan="2"
                Grid.Column="2"
                Header="실시간 영상"
                Style="{StaticResource ModernGroupBoxStyle}">
                <controls:RtspVideoViewer
                    x:Name="RtspViewer"
                    Background="Black"
                    MouseDoubleClick="RtspViewer_MouseDoubleClick" />
            </GroupBox>
        </Grid>

        <!--  하단 상태바 (고정)  -->
        <GroupBox
            Grid.Row="2"
            Header="상태 메세지"
            Style="{StaticResource ModernGroupBoxStyle}">
            <Grid Margin="20,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="30" />
                    <RowDefinition Height="30" />
                </Grid.RowDefinitions>

                <!--  상태 메시지  -->
                <Grid Grid.Row="0" Grid.Column="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="20" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                        Grid.Column="0"
                        Margin="0,0,20,0"
                        Text="검색된 카메라:" />
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <TextBlock
                            FontSize="16"
                            FontWeight="Bold"
                            Foreground="{DynamicResource AccentTextFillColorPrimaryBrush}"
                            Text="{Binding DiscoveredCount}" />
                        <TextBlock Margin="3,0,0,0" Text="대" />
                    </StackPanel>

                    <TextBlock
                        Grid.Column="3"
                        Margin="0,0,20,0"
                        Text="경과 시간:" />
                    <TextBlock
                        Grid.Column="4"
                        FontWeight="SemiBold"
                        Text="{Binding ElapsedTime}" />
                </Grid>
                <StackPanel
                    Grid.Row="1"
                    Grid.Column="0"
                    Grid.ColumnSpan="2"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">
                    <ui:SymbolIcon
                        Margin="0,0,8,0"
                        FontSize="16"
                        Symbol="Info24" />
                    <TextBlock
                        VerticalAlignment="Center"
                        FontWeight="Medium"
                        Text="{Binding StatusMessage}" />
                </StackPanel>
                <!--  선택된 카메라 정보  -->
                <Border
                    Grid.Row="0"
                    Grid.Column="1"
                    Padding="15,5"
                    Background="{DynamicResource SubtleFillColorSecondaryBrush}"
                    CornerRadius="4"
                    Visibility="{Binding SelectedCamera, Converter={StaticResource NullToVisibilityConverter}, FallbackValue=Collapsed}">
                    <StackPanel Orientation="Horizontal">
                        <ui:SymbolIcon
                            Margin="0,0,8,0"
                            FontSize="14"
                            Symbol="Camera24" />
                        <TextBlock VerticalAlignment="Center" Text="선택됨: " />
                        <TextBlock
                            VerticalAlignment="Center"
                            FontWeight="Bold"
                            Foreground="{DynamicResource AccentTextFillColorPrimaryBrush}">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0} ({1})">
                                    <Binding Path="SelectedCamera.IpAddressString" />
                                    <Binding Path="SelectedCamera.StatusText" />
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>
                </Border>
            </Grid>
        </GroupBox>
    </Grid>
</Page>